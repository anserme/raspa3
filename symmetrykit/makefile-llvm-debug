CXX=clang++
OPT=-O0 -fsanitize=address -march=native -ffast-math
CXXFLAGS=$(OPT) -std=c++2b -fopenmp -g -Wall -Wextra -Wshadow -Wnon-virtual-dtor -Wold-style-cast -Wcast-align -Wunused -Woverloaded-virtual -Wpedantic -Wconversion -Wsign-conversion -Wnull-dereference -Wdouble-promotion -Wformat=2 -Wno-gnu-anonymous-struct -Werror -fomit-frame-pointer -ftree-vectorize -fno-stack-check -funroll-loops -fmodules -fbuiltin-module-map -stdlib=libc++ -fprebuilt-module-path=. -fprebuilt-module-path=../foundationkit -fprebuilt-module-path=../mathkit

.PHONY: default
default: libsymmetrykit;

.SUFFIXES:
.SUFFIXES: .pcm .ixx *.cpp

.SECONDARY:

%.o: %.cpp %.pcm
	$(CXX) $(CXXFLAGS) -c $< -o $@

%.pcm: %.ixx
	$(CXX) $(CXXFLAGS) -x c++-module --precompile $< -o $@
	$(CXX) $(CXXFLAGS) -x c++-module -c $< -o $@.o


# dependencies pcm-interface on previous object files
skasymmetricatom.pcm: skatomcopy.o
skcell.pcm: skboundingbox.o
skstructure.pcm: skcell.o skasymmetricatom.o
skparser.pcm: skstructure.o
skposcarparser.pcm: skparser.o
skposcarlegacyparser.pcm: skparser.o skstructure.o skcell.o
sktransformationmatrix.pcm: skrotationmatrix.o
skintegerchangeofbasis.pcm: sktransformationmatrix.o
skseitzintegermatrix.pcm: skrotationmatrix.o skonethirdseitzmatrix.o
skintegersymmetryoperationset.pcm: skdefinitions.o sksymmetrycell.o skseitzintegermatrix.o
skseitzmatrix.pcm: skrotationmatrix.o skonethirdseitzmatrix.o
skpointsymmetryset.pcm: skrotationmatrix.o
sksymmetryoperationset.pcm: skdefinitions.o skpointgroup.o skrotationmatrix.o sktransformationmatrix.o skseitzmatrix.o sksymmetrycell.o
skpointgroup.pcm: skdefinitions.o skrotationaloccurancetable.o skrotationmatrix.o skpointsymmetryset.o sktransformationmatrix.o
skspacegroupsetting.pcm: skdefinitions.o skasymmetricunit.o sktransformationmatrix.o skintegersymmetryoperationset.o skseitzintegermatrix.o skpointgroup.o 
skrotationalchangeofbasis.pcm: skrotationmatrix.o skseitzintegermatrix.o
skspacegroupdatabase.pcm: skspacegroupsetting.o
sksymmetrycell.pcm: skdefinitions.o skrotationmatrix.o sktransformationmatrix.o skpointsymmetryset.o skpointgroup.o
skspacegroup.pcm: skseitzmatrix.o skpointgroup.o skpointsymmetryset.o sksymmetryoperationset.o skspacegroupsetting.o skrotationalchangeofbasis.o skspacegroupdatabase.o sksymmetrycell.o

# dependencies compiled cpp-files on previous object files
skasymmetricatom.o: skatomcopy.o
skcell.o: skboundingbox.o
skstructure.o: skcell.o skasymmetricatom.o
skparser.o: skstructure.o
skposcarparser.o: skparser.o
skposcarlegacyparser.o: skparser.o skstructure.o skcell.o
sktransformationmatrix.o: skrotationmatrix.o
skintegerchangeofbasis.o: sktransformationmatrix.o
skseitzintegermatrix.o: skrotationmatrix.o skonethirdseitzmatrix.o
skintegersymmetryoperationset.o: skdefinitions.o sksymmetrycell.o skseitzintegermatrix.o
skseitzmatrix.o: skrotationmatrix.o skonethirdseitzmatrix.o
skpointsymmetryset.o: skrotationmatrix.o
sksymmetryoperationset.o: skdefinitions.o skpointgroup.o skrotationmatrix.o sktransformationmatrix.o skseitzmatrix.o sksymmetrycell.o
skpointgroup.o: skdefinitions.o skrotationaloccurancetable.o skrotationmatrix.o skpointsymmetryset.o sktransformationmatrix.o
skspacegroupsetting.o: skdefinitions.o skasymmetricunit.o sktransformationmatrix.o skintegersymmetryoperationset.o skseitzintegermatrix.o skpointgroup.o 
skrotationalchangeofbasis.o: skrotationmatrix.o skseitzintegermatrix.o
skspacegroupdatabase.o: skspacegroupsetting.o
sksymmetrycell.o: skdefinitions.o skrotationmatrix.o sktransformationmatrix.o skpointsymmetryset.o skpointgroup.o
skspacegroup.o: skseitzmatrix.o skpointgroup.o skpointsymmetryset.o sksymmetryoperationset.o skspacegroupsetting.o skrotationalchangeofbasis.o skspacegroupdatabase.o sksymmetrycell.o


libsymmetrykit: skdefinitions.o skelement.o skposcarparser.o skparser.o skstructure.o skasymmetricunit.o skcell.o skboundingbox.o skasymmetricatom.o skatomcopy.o sktransformationmatrix.o skintegerchangeofbasis.o skintegersymmetryoperationset.o skrotationaloccurancetable.o skrotationmatrix.o skonethirdseitzmatrix.o skseitzintegermatrix.o skseitzmatrix.o skpointgroup.o skpointsymmetryset.o sksymmetryoperationset.o skspacegroupsetting.o skrotationalchangeofbasis.o skspacegroupdatabase.o sksymmetrycell.o skspacegroup.o
	ar -rs libsymmetrykit.a skdefinitions.pcm.o skdefinitions.o skelement.pcm.o skelement.o skposcarparser.pcm.o skposcarparser.o skparser.pcm.o skparser.o skstructure.pcm.o skstructure.o skasymmetricunit.pcm.o skasymmetricunit.o skcell.pcm.o skcell.o skboundingbox.pcm.o skboundingbox.o skasymmetricatom.pcm.o skasymmetricatom.o skatomcopy.pcm.o skatomcopy.o sktransformationmatrix.pcm.o sktransformationmatrix.o skintegerchangeofbasis.pcm.o skintegerchangeofbasis.o skintegersymmetryoperationset.pcm.o skintegersymmetryoperationset.o skrotationaloccurancetable.pcm.o skrotationaloccurancetable.o skrotationmatrix.pcm.o skrotationmatrix.o skonethirdseitzmatrix.pcm.o skonethirdseitzmatrix.o skseitzintegermatrix.pcm.o skseitzintegermatrix.o skseitzmatrix.pcm.o skseitzmatrix.o skpointgroup.pcm.o skpointgroup.o skpointsymmetryset.pcm.o skpointsymmetryset.o sksymmetryoperationset.pcm.o sksymmetryoperationset.o skspacegroupsetting.pcm.o skspacegroupsetting.o skrotationalchangeofbasis.pcm.o skrotationalchangeofbasis.o skspacegroupdatabase.pcm.o skspacegroupdatabase.o sksymmetrycell.pcm.o sksymmetrycell.o skspacegroup.pcm.o skspacegroup.o
	ranlib -c libsymmetrykit.a

clean:
	rm -f *.pcm *.o *.a
