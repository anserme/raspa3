CXX=clang++
OPT=-O3 -march=native -ffast-math 
CXXFLAGS=$(OPT) -std=c++2b -fopenmp -g -Wall -Wextra -Wshadow -Wnon-virtual-dtor -Wold-style-cast -Wcast-align -Wunused -Woverloaded-virtual -Wpedantic -Wconversion -Wsign-conversion -Wnull-dereference -Wdouble-promotion -Wformat=2 -Werror -fomit-frame-pointer -ftree-vectorize -fno-stack-check -funroll-loops -fmodules -fbuiltin-module-map -stdlib=libc++ -fprebuilt-module-path=. -fprebuilt-module-path=../mathkit -fprebuilt-module-path=../foundationkit -fprebuilt-module-path=../symmetrykit

.PHONY: default
default: libraspakit;

.SUFFIXES:
.SUFFIXES: .pcm .ixx *.cpp

.SECONDARY:

%.o: %.cpp %.pcm
	$(CXX) $(CXXFLAGS) -fmodule-file=$(word 2,$^) -c $< -o $@

%.pcm: %.ixx
	$(CXX) $(CXXFLAGS) -x c++-module --precompile $< -o $@
	$(CXX) $(CXXFLAGS) -x c++-module -c $< -o $@.o


multi_site_isotherm.pcm: isotherm.o
simulationbox.pcm: units.o averages.o
forcefield.pcm: units.o 
property_lambda_probability_histogram.pcm: simulationbox.o averages.o 
property_dudlambda.pcm: averages.o
lambda.pcm: property_dudlambda.o property_lambda_probability_histogram.o averages.o
property_widom.pcm: averages.o
component.pcm: cif_reader.o bond_potential.o multi_site_isotherm.o atom.o averages.o property_widom.o lambda.o forcefield.o
energy_status_inter.pcm: energy_factor.o
energy_status_intra.pcm: energy_factor.o
energy_status.pcm: component.o energy_status_inter.o energy_status_intra.o
property_energy.pcm: energy_status.o energy_status_inter.o energy_status_intra.o averages.o
loadings.pcm: simulationbox.o component.o
property_loading.pcm: loadings.o averages.o
enthalpy_of_adsorption.pcm: units.o averages.o energy_status.o
property_enthalpy.pcm: enthalpy_of_adsorption.o averages.o loadings.o
property_pressure.pcm: averages.o
cif_reader.pcm: forcefield.o simulationbox.o atom.o
potential_energy_vdw.pcm: energy_factor.o forcefield.o
potential_gradient_vdw.pcm: force_factor.o forcefield.o
potential_correction_vdw.pcm: forcefield.o
potential_energy_coulomb.pcm: energy_factor.o forcefield.o
potential_gradient_coulomb.pcm: force_factor.o forcefield.o
cbmc_growing_status.pcm: atom.o component.o running_energy.o bond_potential.o 
cbmc.pcm: atom.o running_energy.o energy_status.o energy_status_intra.o energy_status_inter.o
sample_movies.pcm: units.o atom.o simulationbox.o forcefield.o
property_simulationbox.pcm: averages.o simulationbox.o
system.pcm: atom.o component.o simulationbox.o forcefield.o units.o loadings.o averages.o sample_movies.o enthalpy_of_adsorption.o energy_status.o energy_status_inter.o energy_status_intra.o cbmc.o property_simulationbox.o property_energy.o property_pressure.o property_loading.o property_enthalpy.o lambda.o property_widom.o property_dudlambda.o energy_factor.o running_energy.o isotherm.o multi_site_isotherm.o pressure_range.o bond_potential.o
mc_moves.pcm: system.o cbmc.o component.o atom.o simulationbox.o energy_status.o running_energy.o
monte_carlo.pcm: averages.o system.o property_enthalpy.o mc_moves.o input_reader.o energy_status.o
input_reader.pcm: system.o atom.o component.o simulationbox.o forcefield.o loadings.o enthalpy_of_adsorption.o energy_status.o averages.o
isotherm_fitting.pcm: multi_site_isotherm.o component.o input_reader.o system.o
isotherm_fitting_simulation.pcm: isotherm_fitting.o input_reader.o component.o system.o multi_site_isotherm.o
mixture_prediction.pcm: atom.o isotherm.o multi_site_isotherm.o component.o bond_potential.o system.o
mixture_prediction_simulation.pcm: input_reader.o component.o system.o multi_site_isotherm.o mixture_prediction.o
breakthrough.pcm: component.o input_reader.o mixture_prediction.o system.o
breakthrough_simulation.pcm: breakthrough.o input_reader.o mixture_prediction.o system.o simulationbox.o component.o

multi_site_isotherm.o: isotherm.o
simulationbox.o: units.o averages.o
forcefield.o: units.o 
property_lambda_probability_histogram.o: simulationbox.o averages.o 
property_dudlambda.o: averages.o
lambda.o: property_dudlambda.o property_lambda_probability_histogram.o averages.o
property_widom.o: averages.o
component.o: cif_reader.o bond_potential.o multi_site_isotherm.o atom.o averages.o property_widom.o lambda.o forcefield.o
energy_status_inter.o: energy_factor.o
energy_status_intra.o: energy_factor.o
energy_status.o: component.o energy_status_inter.o energy_status_intra.o
property_energy.o: energy_status.o energy_status_inter.o energy_status_intra.o averages.o
loadings.o: simulationbox.o component.o
property_loading.o: loadings.o averages.o
enthalpy_of_adsorption.o: units.o averages.o energy_status.o
property_enthalpy.o: enthalpy_of_adsorption.o averages.o loadings.o
property_pressure.o: averages.o
cif_reader.o: forcefield.o simulationbox.o atom.o
potential_energy_vdw.o: energy_factor.o forcefield.o
potential_gradient_vdw.o: force_factor.o forcefield.o
potential_correction_vdw.o: forcefield.o
potential_energy_coulomb.o: energy_factor.o forcefield.o
potential_gradient_coulomb.o: force_factor.o forcefield.o
cbmc_growing_status.o: atom.o component.o running_energy.o bond_potential.o 
cbmc.o: atom.o running_energy.o energy_status.o energy_status_intra.o energy_status_inter.o
sample_movies.o: units.o atom.o simulationbox.o forcefield.o
property_simulationbox.o: averages.o simulationbox.o
system.o: atom.o component.o simulationbox.o forcefield.o units.o loadings.o averages.o sample_movies.o enthalpy_of_adsorption.o energy_status.o energy_status_inter.o energy_status_intra.o cbmc.o property_simulationbox.o property_energy.o property_pressure.o property_loading.o property_enthalpy.o lambda.o property_widom.o property_dudlambda.o energy_factor.o running_energy.o isotherm.o multi_site_isotherm.o pressure_range.o bond_potential.o
system_hardware_info.o: system.o
	$(CXX) $(CXXFLAGS) -fmodule-file=system.pcm -c system_hardware_info.cpp -o system_hardware_info.o
system_integration.o: system.o
	$(CXX) $(CXXFLAGS) -fmodule-file=system.pcm -c system_integration.cpp -o system_integration.o
system_interactions_framework_molecule.o: system.o
	$(CXX) $(CXXFLAGS) -fmodule-file=system.pcm -c system_interactions_framework_molecule.cpp -o system_interactions_framework_molecule.o
system_interactions_intermolecular.o: system.o
	$(CXX) $(CXXFLAGS) -fmodule-file=system.pcm -c system_interactions_intermolecular.cpp -o system_interactions_intermolecular.o
system_interactions_ewald.o: system.o
	$(CXX) $(CXXFLAGS) -fmodule-file=system.pcm -c system_interactions_ewald.cpp -o system_interactions_ewald.o
system_interactions_tailcorrection.o: system.o
	$(CXX) $(CXXFLAGS) -fmodule-file=system.pcm -c system_interactions_tailcorrection.cpp -o system_interactions_tailcorrection.o
system_interactions_framework_molecule_pressure.o: system.o
	$(CXX) $(CXXFLAGS) -fmodule-file=system.pcm -c system_interactions_framework_molecule_pressure.cpp -o system_interactions_framework_molecule_pressure.o
system_interactions_intermolecular_pressure.o: system.o
	$(CXX) $(CXXFLAGS) -fmodule-file=system.pcm -c system_interactions_intermolecular_pressure.cpp -o system_interactions_intermolecular_pressure.o
system_interactions_ewald_pressure.o: system.o
	$(CXX) $(CXXFLAGS) -fmodule-file=system.pcm -c system_interactions_ewald_pressure.cpp -o system_interactions_ewald_pressure.o
system_interactions.o: system.o
	$(CXX) $(CXXFLAGS) -fmodule-file=system.pcm -c system_interactions.cpp -o system_interactions.o
system_cbmc_rigid.o: system.o
	$(CXX) $(CXXFLAGS) -fmodule-file=system.pcm -c system_cbmc_rigid.cpp -o system_cbmc_rigid.o
system_cbmc_rigid_insertion.o: system.o
	$(CXX) $(CXXFLAGS) -fmodule-file=system.pcm -c system_cbmc_rigid_insertion.cpp -o system_cbmc_rigid_insertion.o
system_cbmc_rigid_deletion.o: system.o
	$(CXX) $(CXXFLAGS) -fmodule-file=system.pcm -c system_cbmc_rigid_deletion.cpp -o system_cbmc_rigid_deletion.o
system_cbmc_rigid_reinsertion.o: system.o
	$(CXX) $(CXXFLAGS) -fmodule-file=system.pcm -c system_cbmc_rigid_reinsertion.cpp -o system_cbmc_rigid_reinsertion.o
system_compute_fluid_properties.o: system.o
	$(CXX) $(CXXFLAGS) -fmodule-file=system.pcm -c system_compute_fluid_properties.cpp -o system_compute_fluid_properties.o
system_print_enthalpy.o: system.o
	$(CXX) $(CXXFLAGS) -fmodule-file=system.pcm -c system_print_enthalpy.cpp -o system_print_enthalpy.o
system_md_loop.o: system.o
	$(CXX) $(CXXFLAGS) -fmodule-file=system.pcm -c system_md_loop.cpp -o system_md_loop.o
system_print_movestatistics.o: system.o
	$(CXX) $(CXXFLAGS) -fmodule-file=system.pcm -c system_print_movestatistics.cpp -o system_print_movestatistics.o
system_print_energyaverages.o: system.o
	$(CXX) $(CXXFLAGS) -fmodule-file=system.pcm -c system_print_energyaverages.cpp -o system_print_energyaverages.o
system_print_pressure_averages.o: system.o
	$(CXX) $(CXXFLAGS) -fmodule-file=system.pcm -c system_print_pressure_averages.cpp -o system_print_pressure_averages.o
mc_moves.o: system.o cbmc.o component.o atom.o simulationbox.o energy_status.o running_energy.o
mc_moves_translation.o: mc_moves.o
	$(CXX) $(CXXFLAGS) -fmodule-file=mc_moves.pcm -c mc_moves_translation.cpp -o mc_moves_translation.o
mc_moves_random_translation.o: mc_moves.o
	$(CXX) $(CXXFLAGS) -fmodule-file=mc_moves.pcm -c mc_moves_random_translation.cpp -o mc_moves_random_translation.o
mc_moves_rotation.o: mc_moves.o
	$(CXX) $(CXXFLAGS) -fmodule-file=mc_moves.pcm -c mc_moves_rotation.cpp -o mc_moves_rotation.o
mc_moves_random_rotation.o: mc_moves.o
	$(CXX) $(CXXFLAGS) -fmodule-file=mc_moves.pcm -c mc_moves_random_rotation.cpp -o mc_moves_random_rotation.o
mc_moves_reinsertion.o: mc_moves.o
	$(CXX) $(CXXFLAGS) -fmodule-file=mc_moves.pcm -c mc_moves_reinsertion.cpp -o mc_moves_reinsertion.o
mc_moves_insertion.o: mc_moves.o
	$(CXX) $(CXXFLAGS) -fmodule-file=mc_moves.pcm -c mc_moves_insertion.cpp -o mc_moves_insertion.o
mc_moves_deletion.o: mc_moves.o
	$(CXX) $(CXXFLAGS) -fmodule-file=mc_moves.pcm -c mc_moves_deletion.cpp -o mc_moves_deletion.o
mc_moves_swap_cfcmc_cbmc.o: mc_moves.o
	$(CXX) $(CXXFLAGS) -fmodule-file=mc_moves.pcm -c mc_moves_swap_cfcmc_cbmc.cpp -o mc_moves_swap_cfcmc_cbmc.o
mc_moves_widom.o: mc_moves.o
	$(CXX) $(CXXFLAGS) -fmodule-file=mc_moves.pcm -c mc_moves_widom.cpp -o mc_moves_widom.o
mc_moves_volume.o: mc_moves.o
	$(CXX) $(CXXFLAGS) -fmodule-file=mc_moves.pcm -c mc_moves_volume.cpp -o mc_moves_volume.o
mc_moves_gibbs_volume.o: mc_moves.o
	$(CXX) $(CXXFLAGS) -fmodule-file=mc_moves.pcm -c mc_moves_gibbs_volume.cpp -o mc_moves_gibbs_volume.o
monte_carlo.o: averages.o system.o property_enthalpy.o mc_moves.o input_reader.o energy_status.o
input_reader.o: system.o atom.o component.o simulationbox.o forcefield.o loadings.o enthalpy_of_adsorption.o energy_status.o averages.o
isotherm_fitting.o: multi_site_isotherm.o component.o input_reader.o system.o
isotherm_fitting_simulation.o: isotherm_fitting.o input_reader.o component.o system.o multi_site_isotherm.o
mixture_prediction.o: atom.o isotherm.o multi_site_isotherm.o component.o bond_potential.o system.o
mixture_prediction_simulation.o: input_reader.o component.o system.o multi_site_isotherm.o mixture_prediction.o
breakthrough.o: component.o input_reader.o mixture_prediction.o system.o
breakthrough_simulation.o: breakthrough.o input_reader.o mixture_prediction.o system.o simulationbox.o component.o

libraspakit: cif_reader.o isotherm.o pressure_range.o multi_site_isotherm.o isotherm_fitting.o isotherm_fitting_simulation.o mixture_prediction.o mixture_prediction_simulation.o breakthrough.o breakthrough_simulation.o units.o running_energy.o lambda.o simulationbox.o atom.o averages.o property_widom.o property_pressure.o property_simulationbox.o property_energy.o property_loading.o property_enthalpy.o property_lambda_probability_histogram.o property_dudlambda.o forcefield.o component.o framework.o energy_factor.o force_factor.o energy_status.o energy_status_inter.o energy_status_intra.o potential_energy_vdw.o potential_gradient_vdw.o potential_correction_vdw.o potential_energy_coulomb.o potential_energy_coulomb.o potential_gradient_coulomb.o input_reader.o cbmc.o cbmc_growing_status.o monte_carlo.o sample_movies.o loadings.o enthalpy_of_adsorption.o mc_moves_translation.o mc_moves_random_translation.o mc_moves_rotation.o mc_moves_random_rotation.o mc_moves_reinsertion.o mc_moves_insertion.o mc_moves_deletion.o mc_moves_swap_cfcmc_cbmc.o mc_moves_widom.o mc_moves_volume.o mc_moves_gibbs_volume.o system_hardware_info.o system_integration.o system_interactions_framework_molecule.o system_interactions_intermolecular.o system_interactions_ewald.o system_interactions_tailcorrection.o system_interactions_framework_molecule_pressure.o system_interactions_intermolecular_pressure.o system_interactions_ewald_pressure.o system_interactions.o system_cbmc_rigid.o system_cbmc_rigid_insertion.o system_cbmc_rigid_deletion.o system_cbmc_rigid_reinsertion.o system_compute_fluid_properties.o system_print_enthalpy.o system_md_loop.o system_print_movestatistics.o system_print_energyaverages.o system_print_pressure_averages.o
	ar -rs libraspakit.a cif_reader.pcm.o cif_reader.o isotherm.pcm.o isotherm.o pressure_range.pcm.o pressure_range.o multi_site_isotherm.pcm.o multi_site_isotherm.o isotherm_fitting.pcm.o isotherm_fitting.o isotherm_fitting_simulation.pcm.o isotherm_fitting_simulation.o mixture_prediction.pcm.o mixture_prediction.o mixture_prediction_simulation.pcm.o mixture_prediction_simulation.o breakthrough.pcm.o breakthrough.o breakthrough_simulation.pcm.o breakthrough_simulation.o units.pcm.o units.o running_energy.pcm.o running_energy.o lambda.pcm.o lambda.o simulationbox.pcm.o simulationbox.o atom.pcm.o atom.o averages.pcm.o averages.o property_widom.pcm.o property_widom.o property_pressure.pcm.o property_pressure.o property_simulationbox.pcm.o property_simulationbox.o property_energy.pcm.o property_energy.o property_loading.pcm.o property_loading.o property_enthalpy.pcm.o property_enthalpy.o property_lambda_probability_histogram.pcm.o property_lambda_probability_histogram.o property_dudlambda.pcm.o property_dudlambda.o forcefield.pcm.o forcefield.o component.pcm.o component.o framework.pcm.o framework.o energy_factor.pcm.o energy_factor.o force_factor.pcm.o force_factor.o energy_status.pcm.o energy_status.o energy_status_inter.pcm.o energy_status_inter.o energy_status_intra.pcm.o energy_status_intra.o potential_energy_vdw.pcm.o potential_energy_vdw.o potential_gradient_vdw.pcm.o potential_gradient_vdw.o potential_correction_vdw.pcm.o potential_correction_vdw.o potential_energy_coulomb.pcm.o potential_energy_coulomb.o potential_gradient_coulomb.pcm.o potential_gradient_coulomb.o bond_potential.pcm.o bond_potential.o system.pcm.o system.o system_integration.o system_interactions_framework_molecule.o system_interactions_intermolecular.o system_interactions_ewald.o system_interactions_tailcorrection.o system_interactions_framework_molecule_pressure.o system_interactions_intermolecular_pressure.o system_interactions_ewald_pressure.o system_interactions.o system_cbmc_rigid.o system_cbmc_rigid_insertion.o system_cbmc_rigid_deletion.o system_cbmc_rigid_reinsertion.o system_compute_fluid_properties.o system_hardware_info.o system_integration.o system_md_loop.o system_print_enthalpy.o system_print_movestatistics.o system_print_energyaverages.o system_print_pressure_averages.o input_reader.pcm.o input_reader.o cbmc.pcm.o cbmc.o cbmc_growing_status.pcm.o cbmc_growing_status.o mc_moves.pcm.o mc_moves.o mc_moves_translation.o mc_moves_random_translation.o  mc_moves_rotation.o mc_moves_random_rotation.o mc_moves_reinsertion.o mc_moves_insertion.o mc_moves_deletion.o mc_moves_swap_cfcmc_cbmc.o mc_moves_widom.o mc_moves_volume.o mc_moves_gibbs_volume.o monte_carlo.pcm.o monte_carlo.o sample_movies.pcm.o sample_movies.o loadings.pcm.o loadings.o enthalpy_of_adsorption.pcm.o enthalpy_of_adsorption.o
	ranlib -c libraspakit.a
	rm *.o 

clean:
	rm -f *.pcm *.o *.a 
