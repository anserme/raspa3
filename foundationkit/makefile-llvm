CXX=clang++-14
CXXFLAGS= -fopenmp -g -Wformat=2 -Wno-gnu-anonymous-struct -Werror -O3 -march=native -fomit-frame-pointer -ftree-vectorize -fno-stack-check -funroll-loops -ffast-math  -std=c++2b -fmodules -fbuiltin-module-map -stdlib=libc++ -fprebuilt-module-path=. -I/usr/local/src/fmt/include

.PHONY: default
default: libfoundationkit;

.SUFFIXES:
.SUFFIXES: .pcm .ixx *.cpp

.SECONDARY:

%.o: %.cpp %.pcm
	$(CXX) $(CXXFLAGS) -fmodule-file=$(word 2,$^) -c $< -o $@

%.pcm: %.ixx
	$(CXX) $(CXXFLAGS) -x c++-module --precompile $< -o $@

print: print.o
characterset: characterset.o 
indexpath: indexpath.o
scanner: characterset scanner.o 
threading: threading.o
threadpool: threading threadpool.o

libfoundationkit: characterset indexpath scanner print threading threadpool
	ar Scr libfoundationkit.a characterset.o indexpath.o scanner.o print.o threading.o threadpool.o
	ranlib libfoundationkit.a

clean:
	rm -f *.pcm *.o *.a
