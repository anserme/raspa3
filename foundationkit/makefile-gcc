CXX=g++-12
CXXFLAGS=-Wall -Wextra -Wshadow -Wnon-virtual-dtor -Wold-style-cast -Wcast-align -Wunused -Woverloaded-virtual -Wpedantic -Wconversion -Wsign-conversion -Wnull-dereference -Wdouble-promotion -Wformat=2 -Wno-gnu-anonymous-struct -Werror -O3 -march=native -fomit-frame-pointer -ftree-vectorize -fno-stack-check -funroll-loops -ffast-math  -std=c++2b

.PHONY: default
default: libfoundationkit;

.SUFFIXES:
.SUFFIXES: .ixx *.cpp

.SECONDARY:

%.o: %.ixx.o
	$(CXX) $(CXXFLAGS) -x c++ -fmodules-ts -c $*.cpp -o $*_impl.o

%.ixx.o:
	$(CXX) $(CXXFLAGS) -x c++ -fmodules-ts -c $*.ixx -o $*.o


//print: print.o
//threading: threading.o
characterset: characterset.o 
//indexpath: indexpath.o
//scanner: characterset scanner.o 

prepare:
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header vector
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header array
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header utility
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header version
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header string_view
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header iterator
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header iomanip
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header string
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header algorithm
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header cstdio
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header iostream
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header sstream
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header fstream
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header cstdint


libfoundationkit: characterset 
	ar Scr libfoundationkit.a characterset.o characterset_impl.o 
	ranlib libfoundationkit.a

clean:
	rm -f *.pcm *.o *.a
