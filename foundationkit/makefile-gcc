CXX=/usr/local/bin/g++-13
CXXFLAGS=-I/usr/local/Cellar/fmt/10.2.1_1/include -Wall -Wextra -Wshadow -Wnon-virtual-dtor -Wold-style-cast -Wcast-align -Wunused -Woverloaded-virtual -Wpedantic -Wconversion -Wsign-conversion -Wnull-dereference -Wdouble-promotion -Wformat=2 -Wno-gnu-anonymous-struct -O3 -march=native -fomit-frame-pointer -ftree-vectorize -fno-stack-check -funroll-loops -ffast-math  -std=c++2b

CPP    := $(wildcard *.cpp)
PCM    := $(CPP:.cpp=.pcm)
OBJ    := $(CPP:.cpp=.o)
OBJPCM := $(CPP:.cpp=.pcm.o)

.PHONY: default
default: libfoundationkit;

.SUFFIXES:
.SUFFIXES: .ixx *.cpp

.SECONDARY:

%.o: %.ixx.o
	$(CXX) $(CXXFLAGS) -x c++ -fmodules-ts -c $*.cpp -o $*_impl.o

%.ixx.o:
	$(CXX) $(CXXFLAGS) -x c++ -fmodules-ts -c $*.ixx -o $*.o


print: print.o
threading: threading.o
characterset: characterset.o 
indexpath: indexpath.o
scanner: characterset scanner.o 

prepare:
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header cstddef
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header vector
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header array
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header utility
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header version
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header string_view
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header iterator
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header iomanip
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header string
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header algorithm
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header cstdio
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header iostream
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header sstream
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header ostream
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header istream
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header fstream
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header cstdint
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header tuple
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header map
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header bit
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header chrono
	$(CXX) $(CXXFLAGS) -fmodules-ts -x c++-system-header complex


libfoundationkit: $(OBJ)
	ar Scr libfoundationkit.a $(OBJPCM) $(OBJ)
	ranlib libfoundationkit.a

clean:
	rm -f *.pcm *.o *.a
